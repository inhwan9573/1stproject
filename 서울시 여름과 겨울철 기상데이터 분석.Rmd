---
title: "서울시 여름과 겨울철 기상데이터 분석"
author: "러닝스푼즈"
date: "2020년 02월 11일"
output: 
  rmdformats::readthedown: 
    code_folding: hide
    number_sections: true
    self_contained: true
    lightbox: true
    gallery: true
---


# 프로젝트 개요

안녕하세요.
여름이 더울수록 겨울이 춥다는 속설이 맞는지 검증하기 위해 프로젝트를 진행하게 되었습니다.

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)
```


---

# 데이터 정제
## 데이터 불러오기

```{r}
# 라이브러리 불러오기
library(tidyverse)
# 전체 데이터 불러오기
data <- read.csv("./data/seoulsi.csv")
```

## 여름철 데이터 만들기

```{r}
# 6,7,8월만 추출하기
jja <- data.frame()
for (i in seq(1989, 2018, 1)) {
  june <- data[grep(paste0(i, ".06"),data$기간),]
  july <- data[grep(paste0(i, ".07"),data$기간),]
  august <- data[grep(paste0(i, ".08"),data$기간),]
  jja <- rbind(jja, june, july, august)
}
jja <- jja[,-c(2)]
colnames(jja) <- c("년도","평균기온","평균최고기온","극점최고기온",
                   "평균최저기온","극점최저기온","강수량",
                   "평균습도","최소습도","평균해면기압",
                   "이슬점온도","평균운량","일조시간",
                   "평균풍속","최대풍속")
# 변수 수치화(reshape)
jja$강수량 <- as.numeric(jja$강수량)
jja$이슬점온도 <- as.numeric(jja$이슬점온도)
# 데이터 요약하기
summer_df <- jja %>%
  group_by(substr(년도,1,4)) %>% 
  summarise(평균기온=mean(평균기온), 평균최고기온=mean(평균최고기온),
            평균극점최고기온=mean(극점최고기온),극점최고기온=max(극점최고기온),
            평균최저기온=mean(평균최저기온),평균극점최저기온=mean(극점최저기온),
            극점최저기온=min(극점최저기온),강수량=mean(강수량),
            평균습도=mean(평균습도),최소습도=mean(최소습도),
            평균해면기압=mean(평균해면기압),이슬점온도=mean(이슬점온도),
            평균운량=mean(평균운량),일조시간=mean(일조시간),
            평균풍속=mean(평균풍속),최대풍속=mean(최대풍속))
names(summer_df)[names(summer_df) == "substr(년도, 1, 4)"] <- c("년도")
# 열지수 데이터 만들기
heatdata <- read.csv("./data/dataheatindex.csv")
heat_df <- heatdata %>% 
  group_by(year) %>% 
  summarise(열지수=mean(heatindex),최대열지수=max(heatindex))
# 변수 합치고 확인하기
summer <- cbind(summer_df,heat_df)
summer <- summer[,-c(18)]
View(summer)
```

## 겨울철 데이터 만들기

```{r}
djf <- data.frame()
for (i in seq(1989, 2019, 1)) {
  december <- data[grep(paste0(i, ".12"),data$기간),]
  january <- data[grep(paste0(i+1, ".01"),data$기간),]
  febrary <- data[grep(paste0(i+1, ".02"),data$기간),]
  group <- rbind(december,january,febrary)
  djf <- rbind(djf,group)
}
djf <- djf[,-c(2)]
year <- data.frame(rep(1989:2018, each=3),stringsAsFactors = FALSE)
djf <- cbind(djf,year)
colnames(djf) <- c("년도","평균기온","평균최고기온","극점최고기온",
                   "평균최저기온","극점최저기온","강수량",
                   "평균습도","최소습도","평균해면기압",
                   "이슬점온도","평균운량","일조시간",
                   "평균풍속","최대풍속","year")
# 데이터 요약하기
winter_df <- djf %>%
  group_by(year) %>% 
  summarise(겨울평균기온=mean(평균기온), 겨울평균최고기온=mean(평균최고기온),
                겨울평균극점최고기온=mean(극점최고기온),겨울극점최고기온=max(극점최고기온),
                겨울평균최저기온=mean(평균최저기온),겨울평균극점최저기온=mean(극점최저기온),
                겨울극점최저기온=min(극점최저기온),겨울강수량=mean(강수량),
                겨울평균습도=mean(평균습도),겨울최소습도=mean(최소습도),
                겨울평균해면기압=mean(평균해면기압),겨울이슬점온도=mean(이슬점온도),
                겨울평균운량=mean(평균운량),겨울일조시간=mean(일조시간),
                겨울평균풍속=mean(평균풍속),겨울최대풍속=mean(최대풍속))
winter <- winter_df[,-c(1,9:17)]
View(winter)
```

## 여름과 겨울철 데이터 합치기

```{r}
summer_winter_df <- cbind(summer,winter)
View(summer_winter_df)
```

## 데이터 정규화(with scale)

```{r}
scale_df <- as.data.frame(scale(summer_winter_df[2:26]))
View(scale_df)
```

## 독립변수(여름철 기상데이터)와 종속변수(겨울철 기온데이터) 비교분석을 위한 데이터 나누기

```{r}
# 7개로 나누기
summer_winter_average <- scale_df[,-c(20:25)] # 겨울 평균기온과 비교(19)
summer_winter_average_max <- scale_df[,-c(19,21:25)] # 겨울 평균최고기온과 비교(20)
summer_winter_average_pole_max <- scale_df[,-c(19:20,22:25)] # 겨울 평균극점최고기온과 비교(21)
summer_winter_pole_max <- scale_df[,-c(19:21,23:25)] # 겨울 극점최고기온과 비교(22)
summer_winter_average_min <- scale_df[,-c(19:22,24:25)] # 겨울 평균최저기온과 비교(23)
summer_winter_average_pole_min <- scale_df[,-c(19:23,25)] # 겨울 평균극점최저기온과 비교(24)
summer_winter_pole_min <- scale_df[,-c(19:24)] # 겨울 극점최저기온과 비교(25)
```

## 데이터 구조확인 {.tabset .tabset-pills}
### structure
```{r}
str(summer_winter_average)
```
```{r}
str(summer_winter_average_max)
```
```{r}
str(summer_winter_average_pole_max)
```
```{r}
str(summer_winter_pole_max)
```
```{r}
str(summer_winter_average_min)
```
```{r}
str(summer_winter_average_pole_min)
```
```{r}
str(summer_winter_pole_min)
```

### summary
```{r}
summary(summer_winter_average)
```
```{r}
summary(summer_winter_average_max)
```
```{r}
summary(summer_winter_average_pole_max)
```
```{r}
summary(summer_winter_pole_max)
```
```{r}
summary(summer_winter_average_min)
```
```{r}
summary(summer_winter_average_pole_min)
```
```{r}
summary(summer_winter_pole_min)
```

---

# 데이터 분석
## 상관관계분석(with ggcorr plot) {.tabset .tabset-pills}
```{r}
library(GGally)
```

### 여름과 겨울철 평균기온의 상관관계 
```{r}
#summer - winter_average
ggcorr(summer_winter_average[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_average")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

### 여름과 겨울철 평균최고기온의 상관관계
```{r}
#summer - winter_average_max
ggcorr(summer_winter_average_max[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_average_max")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

### 여름과 겨울철 평균극점최고기온의 상관관계
```{r}
#summer - winter_average_pole_max
ggcorr(summer_winter_average_pole_max[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_average_pole_max")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

### 여름과 겨울철 극점최고기온의 상관관계
```{r}
#summer - winter_pole_max
ggcorr(summer_winter_pole_max[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_pole_max")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

### 여름과 겨울철 평균최저기온의 상관관계
```{r}
#summer - winter_average_min
ggcorr(summer_winter_average_min[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_average_min")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

### 여름과 겨울철 평균극점최저기온의 상관관계
```{r}
#summer - winter_average_pole_min
ggcorr(summer_winter_average_pole_min[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_average_pole_min")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

### 여름과 겨울철 극점최저기온의 상관관계
```{r}
#summer - winter_pole_min
ggcorr(summer_winter_pole_min[,c(1:19)], name = "corr", label = TRUE)+
  theme(legend.position="none")+
  labs(title="summer - winter_pole_min")+
  theme(plot.title=element_text(face='bold',color='black',hjust=0.1,size=14))
```

---

## 주성분분석(PCA) 
```{r}
library(factoextra)
```

### summary {.tabset .tabset-pills}
#### 여름과 겨울평균기온
```{r}
swa_pca <- transform(summer_winter_average)
swa_all_pca <- prcomp(swa_pca,cor=TRUE,scale=TRUE)
summary(swa_all_pca)
```

#### 여름과 겨울평균최고기온
```{r}
swam_pca <- transform(summer_winter_average_max)
swam_all_pca <- prcomp(swam_pca,cor=TRUE,scale=TRUE)
summary(swam_all_pca)
```

#### 여름과 겨울평균극점최고기온
```{r}
swapm_pca <- transform(summer_winter_average_pole_max)
swapm_all_pca <- prcomp(swapm_pca,cor=TRUE,scale=TRUE)
summary(swapm_all_pca)
```

#### 여름과 겨울극점최고기온
```{r}
swpm_pca <- transform(summer_winter_pole_max)
swpm_all_pca <- prcomp(swpm_pca,cor=TRUE,scale=TRUE)
summary(swpm_all_pca)
```

#### 여름과 겨울평균최저기온
```{r}
swami_pca <- transform(summer_winter_average_min)
swami_all_pca <- prcomp(swami_pca,cor=TRUE,scale=TRUE)
summary(swami_all_pca)
```

#### 여름과 겨울평균극점최저기온
```{r}
swapmi_pca <- transform(summer_winter_average_pole_min)
swapmi_all_pca <- prcomp(swapmi_pca,cor=TRUE,scale=TRUE)
summary(swapmi_all_pca)
```

#### 여름과 겨울극점최저기온
```{r}
swpmi_pca <- transform(summer_winter_pole_min)
swpmi_all_pca <- prcomp(swpmi_pca,cor=TRUE,scale=TRUE)
summary(swpmi_all_pca)
```

### scree plot {.tabset .tabset-pills}
#### 여름과 겨울평균기온
```{r}
fviz_eig(swa_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_average Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

#### 여름과 겨울평균최고기온
```{r}
fviz_eig(swam_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_average_max Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

#### 여름과 겨울평균극점최고기온
```{r}
fviz_eig(swapm_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_average_pole_max Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

#### 여름과 겨울극점최고기온
```{r}
fviz_eig(swpm_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_pole_max Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

#### 여름과 겨울평균최저기온
```{r}
fviz_eig(swami_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_average_min Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

#### 여름과 겨울평균극점최저기온
```{r}
fviz_eig(swapmi_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_average_pole_min Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

#### 여름과 겨울극점최저기온
```{r}
fviz_eig(swpmi_all_pca, addlabels=TRUE, ylim=c(0,50), geom = c("bar", "line"),
         barfill = "skyblue", barcolor="grey",linecolor = "red", ncp=10)+
  labs(title = "summer-winter_pole_min Variances - PCA",
       x = "Principal Components", y = "% of variances")
```

### 중요변수 확인하기(with corrplot) {.tabset .tabset-pills}
```{r}
library(corrplot)
```

#### 여름과 겨울평균기온 중요변수
```{r}
swa_var <- get_pca_var(swa_all_pca)
swa_var
corrplot(swa_var$cos2,is.corr = FALSE)
```

#### 여름과 겨울평균최고기온 중요변수
```{r}
swam_var <- get_pca_var(swam_all_pca)
swam_var
corrplot(swam_var$cos2,is.corr = FALSE)
```

#### 여름과 겨울평균극점최고기온 중요변수
```{r}
swapm_var <- get_pca_var(swapm_all_pca)
swapm_var
corrplot(swapm_var$cos2,is.corr = FALSE)
```

#### 여름과 겨울극점최고기온 중요변수
```{r}
swpm_var <- get_pca_var(swpm_all_pca)
swpm_var
corrplot(swpm_var$cos2,is.corr = FALSE)
```

#### 여름과 겨울평균최저기온 중요변수
```{r}
swami_var <- get_pca_var(swami_all_pca)
swami_var
corrplot(swami_var$cos2,is.corr = FALSE)
```

#### 여름과 겨울평균극점최저기온 중요변수
```{r}
swapmi_var <- get_pca_var(swapm_all_pca)
swapm_var
corrplot(swapm_var$cos2,is.corr = FALSE)
```

#### 여름과 겨울극점최저기온 중요변수
```{r}
swpmi_var <- get_pca_var(swpmi_all_pca)
swpmi_var
corrplot(swpmi_var$cos2,is.corr = FALSE)
```